<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>OnChange (Permazen 4.2.0 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../jquery/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="OnChange (Permazen 4.2.0 API)";
        }
    }
    catch(err) {
    }
//-->
var pathtoroot = "../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OnChange.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.optional.element.summary">Optional</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.element.detail">Element</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">io.permazen.annotation</a></div>
<h2 title="Annotation Type OnChange" class="title">Annotation Type OnChange</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true" title="class or interface in java.lang.annotation" class="externalLink">@Retention</a>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/RetentionPolicy.html?is-external=true#RUNTIME" title="class or interface in java.lang.annotation" class="externalLink">RUNTIME</a>)
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true" title="class or interface in java.lang.annotation" class="externalLink">@Target</a>({<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html?is-external=true#ANNOTATION_TYPE" title="class or interface in java.lang.annotation" class="externalLink">ANNOTATION_TYPE</a>,<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html?is-external=true#METHOD" title="class or interface in java.lang.annotation" class="externalLink">METHOD</a>})
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Documented.html?is-external=true" title="class or interface in java.lang.annotation" class="externalLink">@Documented</a>
public @interface <span class="memberNameLabel">OnChange</span></pre>
<div class="block">Annotation for methods that are to be invoked whenever a simple or complex target field in some target object changes
 during a transaction, where the target object containing the changed field is found at the end of a path of references
 starting from the object to be notified.
 See <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> for more information about reference paths.

 <p><b>Overview</b></p>

 There several ways to control which changes are delivered to the annotated method:
 <ul>
  <li>By specifying a path of object references, via <a href="#value()"><code>value()</code></a>, to the target object and field</li>
  <li>By widening or narrowing the type of the <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange</code></a> method parameter
      (or omitting it altogether)</li>
  <li>By declaring an instance method, to monitor changes from the perspective of the associated object,
      or a static method, to monitor changes from a global perspective</li>
  <li>By <a href="#snapshotTransactions()">allowing or disallowing</a> notifications that occur within
      <a href="../SnapshotJTransaction.html" title="class in io.permazen">snapshot transactions</a>.</li>
 </ul>
 A class may have multiple <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a> methods, each with a specific purpose.

 <p><b>Examples</b></p>

 <pre>
   &#64;PermazenType
   public abstract class Account implements JObject {

   // Database fields

       public abstract boolean isEnabled();
       public abstract void setEnabled(boolean enabled);

       &#64;NotNull
       public abstract String getName();
       public abstract void setName(String name);

       public abstract NavigableSet&lt;AccessLevel&gt; getAccessLevels();

   // &#64;OnChange methods

       &#64;OnChange      // equivalent to &#64;OnChange("*")
       private void handleAnyChange1() {
           // Sees any change to ANY field of THIS account
       }

       &#64;OnChange("*")
       private void handleAnyChange2(FieldChange&lt;Account&gt; change) {
           // Sees any change to ANY field of THIS account
       }

       &#64;OnChange("*")
       private static void handleAnyChange3(FieldChange&lt;Account&gt; change) {
           // Sees any change to ANY field of ANY account (note static method)
       }

       &#64;OnChange("accessLevels")
       private void handleAccessLevelsChange(SetFieldAdd&lt;Account, AccessLevel&gt; change) {
           // Sees any addition to THIS accounts access levels
       }

       &#64;OnChange
       private void handleSimpleChange(SimpleFieldChange&lt;Account, ?&gt; change) {
           // Sees any change to any SIMPLE field of THIS account (e.g., enabled, name)
       }

       &#64;OnChange(startType = User.class, value = "account")
       private static void handleMembershipChange(SimpleFieldChange&lt;User, Account&gt; change) {
           // Sees any change to which users are associated with ANY account
       }
   }

   &#64;PermazenType
   public abstract class User implements JObject {

   // Database fields

       &#64;NotNull
       &#64;JField(indexed = true, unique = true)
       public abstract String getUsername();
       public abstract void setUsername(String username);

       &#64;NotNull
       public abstract Account getAccount();
       public abstract void setAccount(Account account);

       public abstract NavigableSet&lt;User&gt; getFriends();

   // &#64;OnChange methods

       &#64;OnChange("username")
       private void handleUsernameChange(SimpleFieldChange&lt;User, String&gt; change) {
           // Sees any change to THIS user's username
       }

       &#64;OnChange("account.enabled")
       private void handleUsernameChange(SimpleFieldChange&lt;Account, Boolean&gt; change) {
           // Sees any change to THIS user's account's enabled status
       }

       &#64;OnChange("friends.element.friends.element.account.*")
       private void handleFOFAccountNameChange(SimpleFieldChange&lt;Account, ?&gt; change) {
           // Sees any change to any simple field in any friend-of-a-friend's Account
       }

       &#64;OnChange("account.^User:account^.username")
       private void handleSameAccountUserUsernameChange(SimpleFieldChange&lt;User, String&gt; change) {
           // Sees changes to the username of any User with the same Account as this instance
           // Note the use of the inverse step "^User:account^" from Account back to User
       }
   }
 </pre>

 <p><b>Method Parameter Types</b></p>

 <p>
 In all cases the annotated method must return void and take zero or one parameter; the parameter must be compatible
 with at least one of the <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange</code></a> sub-types appropriate for the field being watched.
 The method parameter type can be used to restrict which notifications are delivered. For example, an annotated method
 taking a <a href="../change/SetFieldChange.html" title="class in io.permazen.change"><code>SetFieldChange</code></a> will receive notifications about all changes to a set field,
 while a method taking a <a href="../change/SetFieldAdd.html" title="class in io.permazen.change"><code>SetFieldAdd</code></a> will receive notification only when an element
 is added to the set.

 <p>
 A method with zero parameters is delivered all possible notifications, which is equivalent to having an ignored
 parameter of type <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange&lt;?&gt;</code></a>.

 <p>
 The method may have any level of access, including <code>private</code>, and multiple independent <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a>
 methods are allowed.

 <p>
 Multiple reference paths may be specified; if so, all of the specified paths are monitored together, and they all
 must emit <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange</code></a>s compatible with the method's parameter type. Therefore, when
 multiple fields are monitored, the method's parameter type may need to be widened (either in raw type, generic type
 parameters, or both).

 <p>
 As a special case, if the last field is <code>"*"</code> (wildcard), then every field in the target object is matched.
 However, only fields that emit changes compatible with the method's parameter type will be monitored.
 So for example, a method taking a <a href="../change/SetFieldChange.html" title="class in io.permazen.change"><code>SetFieldChange</code></a> would receive notifications about
 changes to all <code>Set</code> fields in the class, but not any other fields. Currently, due to type erasure, only
 the parameter's raw type is taken into consideration.

 <p><b>Instance vs. Static Methods</b></p>

 <p>
 If the method is an instance method, then <a href="#startType()"><code>startType()</code></a> must be left unset; if the instance is a static
 method, then <a href="#startType()"><code>startType()</code></a> may be explicitly set, or if left unset it defaults to the class containing
 the annotated method.

 <p>
 For an instance method, the method will be invoked on <i>each object</i> for which the changed field is
 found at the end of the specified reference path <i>starting from that object</i>.

 <p>
 If the annotated method is a static method, the method is invoked <i>once</i> if any instance exists for which the
 changed field is found at the end of the specified reference path, no matter how many such instances there are.
 Otherwise the behavior is the same.

 <p><b>Notification Delivery</b></p>

 <p>
 Notifications are delivered synchronously within the thread the made the change, after the change is made and just
 prior to returning to the original caller.
 Additional changes made within an <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a> handler that themselves result in notifications
 are also handled prior to returning to the original caller. Therefore, infinite loops are possible if an
 <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a> handler method modifies the field it's monitoring (directly, or indirectly via
 other <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a> handler methods).

 <p>
 <a href="OnChange.html" title="annotation in io.permazen.annotation"><code>&#64;OnChange</code></a> functions within a single transaction; it does not notify about changes that
 may have occurred in a different transaction.

 <p><b>Fields of Sub-Types</b>

 <p>
 The same field can appear in multiple sub-types, e.g., when implementing a Java interface containing a Permazen field.
 This can lead to some subtleties: for example, in some cases, a field may not exist in a Java object type, but it does
 exist in a some sub-type of that type:

 <pre>
 &#64;PermazenType
 public class Person {

     public abstract Set&lt;Person&gt; <b>getFriends</b>();

     &#64;OnChange("friends.element.<b>name</b>")
     private void friendNameChanged(SimpleFieldChange&lt;NamedPerson, String&gt; change) {
         // ... do whatever
     }
 }

 &#64;PermazenType
 public class NamedPerson extends Person {

     public abstract String <b>getName</b>();
     public abstract void setName(String name);
 }
 </pre>

 Here the path <code>"friends.element.name"</code> seems incorrect because <code>"friends.element"</code> has type <code>Person</code>,
 while <code>"name"</code> is a field of <code>NamedPerson</code>, a narrower type than <code>Person</code>. However, this will still
 work as long as there is no ambiguity, i.e., in this example, there are no other sub-types of <code>Person</code> with a field
 named <code>"name"</code>. Note also in the example above the <a href="../change/SimpleFieldChange.html" title="class in io.permazen.change"><code>SimpleFieldChange</code></a> parameter to the
 method <code>friendNameChanged()</code> necessarily has generic type <code>NamedPerson</code>, not <code>Person</code>.

 <p><b>Other Notes</b></p>

 <p>
 <a href="../Counter.html" title="class in io.permazen"><code>Counter</code></a> fields do not generate change notifications.

 <p>
 No notifications are delivered for "changes" that do not actually change anything (e.g., setting a simple field to
 the value already contained in that field, or adding an element to a set which is already contained in the set).

 <p>
 For any given field change and path, only one notification will be delivered per recipient object, even if the changed field
 is seen through the path in multiple ways (e.g., via reference path <code>"mylist.element.myfield"</code> where the changed object
 containing <code>myfield</code> appears multiple times in <code>mylist</code>).

 <p>
 See <a href="../core/Transaction.html#addSimpleFieldChangeListener(int,int%5B%5D,io.permazen.kv.KeyRanges%5B%5D,io.permazen.core.SimpleFieldChangeListener)"><code>Transaction.addSimpleFieldChangeListener()</code></a>
 for further information on other special corner cases.

 <p><b>Meta-Annotations</b></p>

 <p>
 This annotation may be configured indirectly as a Spring
 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations">meta-annotation</a>
 when <code>spring-core</code> is on the classpath.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a>, 
<a href="../change/package-summary.html"><code>io.permazen.change</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== ANNOTATION TYPE OPTIONAL MEMBER SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="annotation.type.optional.element.summary">
<!--   -->
</a>
<h3>Optional Element Summary</h3>
<table class="memberSummary">
<caption><span>Optional Elements</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Optional Element</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#snapshotTransactions()">snapshotTransactions</a></span></code></th>
<td class="colLast">
<div class="block">Determines whether this annotation should also be enabled for
 <a href="../SnapshotJTransaction.html" title="class in io.permazen">snapshot transaction</a> objects.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html?is-external=true" title="class or interface in java.lang" class="externalLink">Class</a>&lt;?&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#startType()">startType</a></span></code></th>
<td class="colLast">
<div class="block">Specifies the starting type for the <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> specified by <a href="#value()"><code>value()</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a>[]</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#value()">value</a></span></code></th>
<td class="colLast">
<div class="block">Specifies the path(s) to the target field(s) to watch for changes.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ ANNOTATION TYPE MEMBER DETAIL =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="annotation.type.element.detail">
<!--   -->
</a>
<h3>Element Detail</h3>
<a id="value()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>value</h4>
<pre><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a>[]&nbsp;value</pre>
<div class="block">Specifies the path(s) to the target field(s) to watch for changes.
 See <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> for information on the proper syntax.

 <p>
 Multiple paths may be specified; if so, each path is handled as a separate independent listener registration,
 and the method's parameter type must be compatible with at least one of the <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange</code></a>
 sub-types emitted by each field.

 <p>
 If zero paths are specified (the default), every field in the class (including superclasses) that emits
 <a href="../change/FieldChange.html" title="class in io.permazen.change"><code>FieldChange</code></a>s compatible with the method parameter will be monitored for changes.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>reference path leading to the changed field</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a></dd>
</dl>
<dl>
<dt>Default:</dt>
<dd>{}</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<section>
<ul class="blockList">
<li class="blockList"><a id="startType()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>startType</h4>
<pre><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html?is-external=true" title="class or interface in java.lang" class="externalLink">Class</a>&lt;?&gt;&nbsp;startType</pre>
<div class="block">Specifies the starting type for the <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> specified by <a href="#value()"><code>value()</code></a>.

 <p>
 This property must be left unset for instance methods. For static methods, if this property is left unset,
 then then class containing the annotated method is assumed.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Java type at which the reference path starts</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a></dd>
</dl>
<dl>
<dt>Default:</dt>
<dd>void.class</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<section>
<ul class="blockList">
<li class="blockList"><a id="snapshotTransactions()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>snapshotTransactions</h4>
<pre>boolean&nbsp;snapshotTransactions</pre>
<div class="block">Determines whether this annotation should also be enabled for
 <a href="../SnapshotJTransaction.html" title="class in io.permazen">snapshot transaction</a> objects.
 If unset, notifications will only be delivered to non-snapshot (i.e., normal) database instances.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>whether enabled for snapshot transactions</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../SnapshotJTransaction.html" title="class in io.permazen"><code>SnapshotJTransaction</code></a></dd>
</dl>
<dl>
<dt>Default:</dt>
<dd>false</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OnChange.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.optional.element.summary">Optional</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.element.detail">Element</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2023. All rights reserved.</small></p>
</footer>
</body>
</html>
