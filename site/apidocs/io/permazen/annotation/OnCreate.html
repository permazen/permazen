<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>OnCreate (Permazen 5.1.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: io.permazen.annotation, annotation type: OnCreate">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/OnCreate.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Optional&nbsp;|&nbsp;</li>
<li>Required</li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Element</li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.permazen.annotation</a></div>
<h1 title="Annotation Interface OnCreate" class="title">Annotation Interface OnCreate</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#RUNTIME" title="class or interface in java.lang.annotation" class="external-link">RUNTIME</a>)
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>({<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#ANNOTATION_TYPE" title="class or interface in java.lang.annotation" class="external-link">ANNOTATION_TYPE</a>,<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#METHOD" title="class or interface in java.lang.annotation" class="external-link">METHOD</a>})
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Documented.html" title="class or interface in java.lang.annotation" class="external-link">@Documented</a>
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">OnCreate</span></div>
<div class="block">Annotates Permazen model class methods that are to be invoked whenever a database object is newly created.

 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-java.min.js"></script>
 <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism.min.css" rel="stylesheet"/>

 <p><b>Overview</b></p>

 <p>
 When a <i>matching object</i> is created, annotated methods are invoked just after the object's creation.

 <p>
 For instance methods, the annotated method may take either zero or one parameter (the newly created object).
 Zero is typical, in which case a matching object is any object that is an instance of the method's declaring class,
 i.e., newly created objects receive their own notifications.

 <p>
 If the method has one parameter, then newly created objects still notify themselves but only when their types
 match the parameter's type (the new object is both the method receiver and method parameter). The latter case
 is less common but useful for example when a superclass method is only interested in the creation of
 specific sub-types.

 <p>
 For static methods, a method parameter is required and a matching object is one whose type is compatible with it.

 <p>
 The annotated method may may have any level of access, including <code>private</code>.

 <p>
 A class may have multiple <a href="OnCreate.html" title="annotation interface in io.permazen.annotation"><code>&#64;OnCreate</code></a> methods, each with a specific purpose.

 <p>
 Note that there is a subtle distinction between (a) the creation of objects in the database (i.e., the event that
 this annotation concerns), and (b) the instantiation of an actual Java model object representing a database object.
 These two events are different; in particular, distinct Java objects are created to represent the same database
 object in different transactions. It's even possible for a Java model object to be instantiated even though no
 corresponding database object exists in the database (via
 <a href="../PermazenTransaction.html#get(io.permazen.core.ObjId)"><code>PermazenTransaction.get()</code></a>).

 <p>
 As a consequence, any operations specific to the creation of new database instance, such as one-time initialization
 of database fields, should take place in <a href="OnCreate.html" title="annotation interface in io.permazen.annotation"><code>&#64;OnCreate</code></a>-annotated methods instead of constructors.

 <p>
 For example, instead of doing this:

 <p>
 <pre><code class="language-java">
  &#64;PermazenType
  public abstract class Event {

      protected Event() {
          this.setCreateTime(Instant.now());
      }

      &#64;NotNull
      public abstract Instant getCreateTime();
      public abstract void setCreateTime(Instant createTime);
  }
 </code></pre>

 <p>
 do this:
 <pre><code class="language-java">
  &#64;PermazenType
  public abstract class Event {

      &#64;NotNull
      public abstract Instant getCreateTime();
      public abstract void setCreateTime(Instant createTime);

      &#64;OnCreate
      private void initializeCreateTime() {
          this.setCreateTime(Instant.now());
      }
  }
 </code></pre>

 <p><b>Notification Delivery</b></p>

 <p>
 Notifications are delivered in the same thread that created the object, immediately after the object is created.

 <p>
 Some notifications may need to be ignored by objects in <a href="../DetachedPermazenTransaction.html" title="class in io.permazen">detached</a> transactions;
 you can use <code>this.isDetached()</code> to detect that situation.

 <p>
 Actions that have effects visible to the outside world should be made contingent on successful transaction commit,
 for example, via <a href="../core/Transaction.html#addCallback(io.permazen.core.Transaction.Callback)"><code>Transaction.addCallback()</code></a>.

 <p><b>Meta-Annotations</b></p>

 <p>
 This annotation may be configured indirectly as a Spring
 <a href="https://docs.spring.io/spring-framework/reference/core/beans/classpath-scanning.html#beans-meta-annotations">meta-annotation</a>
 when <code>spring-core</code> is on the classpath.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="OnDelete.html" title="annotation interface in io.permazen.annotation"><code>OnDelete</code></a></li>
</ul>
</dd>
</dl>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2024. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
