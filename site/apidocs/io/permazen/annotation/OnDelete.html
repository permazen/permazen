<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>OnDelete (Permazen 5.2.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: io.permazen.annotation, annotation type: OnDelete">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/OnDelete.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a>&nbsp;|&nbsp;</li>
<li>Required</li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.permazen.annotation</a></div>
<h1 title="Annotation Interface OnDelete" class="title">Annotation Interface OnDelete</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#RUNTIME" title="class or interface in java.lang.annotation" class="external-link">RUNTIME</a>)
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>({<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#ANNOTATION_TYPE" title="class or interface in java.lang.annotation" class="external-link">ANNOTATION_TYPE</a>,<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#METHOD" title="class or interface in java.lang.annotation" class="external-link">METHOD</a>})
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Documented.html" title="class or interface in java.lang.annotation" class="external-link">@Documented</a>
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">OnDelete</span></div>
<div class="block">Annotates Permazen model class methods that are to be invoked whenever an object is about to be deleted.

 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-java.min.js"></script>
 <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism.min.css" rel="stylesheet"/>

 <p><b>Overview</b></p>

 <p>
 When a <i>matching object</i> is deleted, annotated methods are invoked just prior to actual deletion.

 <p>
 Methods must return void and normally take one parameter. A matching object is one whose type is compatible
 with the method parameter and which is found at the end of the <a href="../ReferencePath.html" title="class in io.permazen">reference path</a>
 specified by <a href="#path()"><code>path()</code></a>, starting from the object to be notified. See <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> for more
 information about reference paths.

 <p>
 In the case of an instance method where <a href="#path()"><code>path()</code></a> is empty (the default), the method is allowed to take
 zero parameters; in this case, the object monitors itself.

 <p>
 For static methods, <a href="#path()"><code>path()</code></a> must be empty and every object whose type is compatible with the method's parameter
 is a matching object and can produce notifications.

 <p>
 The annotated method may may have any level of access, including <code>private</code>.

 <p>
 A class may have multiple <a href="OnDelete.html" title="annotation interface in io.permazen.annotation"><code>&#64;OnDelete</code></a> methods, each with a specific purpose.

 <p><b>Examples</b></p>

 <p>
 This example shows various ways an annotated method can be matched:

 <pre><code class="language-java">
   &#64;PermazenType
   public abstract class User implements PermazenObject {

       public abstract Account getAccount();
       public abstract void setAccount(Account account);

       &#64;OnDelete(path = "-&gt;account")
       private void handleDeletion1(Account account) {
           // Invoked when MY Account is deleted
       }
   }

   &#64;PermazenType
   public abstract class Feature implements PermazenObject {

       public abstract Account getAccount();
       public abstract void setAccount(Account account);

       &#64;OnDelete(path = "-&gt;account&lt;-User.account")
       private void handleDeletion1(User user) {
           // Invoked when ANY User associated with MY Account is deleted
       }
   }

   &#64;PermazenType
   public abstract class Account implements PermazenObject {

       &#64;NotNull
       public abstract String getName();
       public abstract void setName(String name);

   // Non-static &#64;OnDelete methods

       &#64;OnDelete
       private void handleDeletion1() {
           // Invoked when THIS Account is deleted
       }

       &#64;OnDelete
       private void handleDeletion2(SpecialAccount self) {
           // Invoked when THIS Account is deleted IF it's also a SpecialAccount
       }

       &#64;OnDelete(path = "&lt;-User.account")
       private void handleDeletion3(User user) {
           // Invoked when ANY User associated with THIS Account is deleted
       }

       &#64;OnDelete(path = "&lt;-User.account")
       private void handleDeletion4(Object obj) {
           // Invoked when ANY User OR Feature associated with THIS Account is deleted
       }

       &#64;OnDelete(path = "&lt;-Feature.account-&gt;account&lt;-User.account")
       private void handleDeletion5(User user) {
           // Invoked when ANY User associated with the same Account
           // as ANY Feature associated with THIS Account is deleted
       }

  // Static &#64;OnDelete methods

       &#64;OnDelete
       private static void handleDeletion5(Object obj) {
           // Invoked when ANY object is deleted
       }

       &#64;OnDelete
       private static void handleDeletion6(Account account) {
           // Invoked when ANY Account is deleted
       }
   }
 </code></pre>

 <p><b>Instance vs. Static Methods</b></p>

 <p>
 An instance method will be invoked on <i>each object</i> for which the deleted object is found at the end
 of the specified reference path, starting from that object. For example, if there are three child <code>Node</code>'s
 pointing to the same parent <code>Node</code>, and the <code>Node</code> class has an instance method annotated with
 <a href="OnDelete.html" title="annotation interface in io.permazen.annotation"><code>&#64;OnDelete</code></a><code>(path = "parent")</code>, then all three child <code>Node</code>'s will be notified
 when the parent is deleted.

 <p>
 A static method is invoked <i>once</i> for any matching object; the <a href="#path()"><code>path()</code></a> is ignored and must be empty.

 <p><b>Notification Delivery</b></p>

 <p>
 Notifications are delivered in the same thread that deletes the object, before the deletion actually occurs.
 At most one delete notification will ever be delivered for any object deletion event. In particular, if an
 annotated method attempts to re-entrantly delete the same object again, no new notification is delivered.

 <p>
 Some notifications may need to be ignored by objects in <a href="../DetachedPermazenTransaction.html" title="class in io.permazen">detached</a> transactions;
 you can use <code>this.isDetached()</code> to detect that situation.

 <p>
 Actions that have effects visible to the outside world should be made contingent on successful transaction commit,
 for example, via <a href="../core/Transaction.html#addCallback(io.permazen.core.Transaction.Callback)"><code>Transaction.addCallback()</code></a>.

 <p><b>Meta-Annotations</b></p>

 <p>
 This annotation may be configured indirectly as a Spring
 <a href="https://docs.spring.io/spring-framework/reference/core/beans/classpath-scanning.html#beans-meta-annotations">meta-annotation</a>
 when <code>spring-core</code> is on the classpath.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="OnCreate.html" title="annotation interface in io.permazen.annotation"><code>OnCreate</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== ANNOTATION INTERFACE OPTIONAL MEMBER SUMMARY =========== -->
<li>
<section class="member-summary" id="annotation-interface-optional-element-summary">
<h2>Optional Element Summary</h2>
<div class="caption"><span>Optional Elements</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Optional Element</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color"><code><a href="#path()" class="member-name-link">path</a></code></div>
<div class="col-last even-row-color">
<div class="block">Specify the reference path to the target object(s) that should be monitored for deletion.</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details" id="annotation-interface-element-detail">
<ul class="details-list">
<!-- ============ ANNOTATION INTERFACE MEMBER DETAIL =========== -->
<li>
<section class="member-details">
<h2>Element Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="path()">
<h3>path</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">path</span></div>
<div class="block">Specify the reference path to the target object(s) that should be monitored for deletion.
 See <a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a> for information on reference paths and their proper syntax.

 <p>
 The default empty path means the monitored object and the notified object are the same. In that case,
 the type of the parameter (if any) restricts notifications to compatible subclasses.

 <p>
 When annotating static methods, this property is unused and must be left unset.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>reference path leading to monitored objects</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../ReferencePath.html" title="class in io.permazen"><code>ReferencePath</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd>""</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2024. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
