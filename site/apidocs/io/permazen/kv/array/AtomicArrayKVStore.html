<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>AtomicArrayKVStore (Permazen 5.2.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: io.permazen.kv.array, class: AtomicArrayKVStore">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/AtomicArrayKVStore.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.permazen.kv.array</a></div>
<h1 title="Class AtomicArrayKVStore" class="title">Class AtomicArrayKVStore</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance"><a href="../AbstractKVStore.html" title="class in io.permazen.kv">io.permazen.kv.AbstractKVStore</a>
<div class="inheritance">io.permazen.kv.array.AtomicArrayKVStore</div>
</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code>, <code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="annotations">@ThreadSafe
</span><span class="modifiers">public class </span><span class="element-name type-name-label">AtomicArrayKVStore</span>
<span class="extends-implements">extends <a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a>
implements <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></span></div>
<div class="block"><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a> based on <a href="ArrayKVStore.html" title="class in io.permazen.kv.array"><code>ArrayKVStore</code></a> plus a write-ahead log and background compaction.

 <p>
 This implementation is designed to maximize the speed of reads and minimize the amount of memory overhead per key/value pair.
 It is optimized for relatively infrequent writes.

 <p>
 A (read-only) <a href="ArrayKVStore.html" title="class in io.permazen.kv.array"><code>ArrayKVStore</code></a> is the basis for the database; the array files are mapped into memory. As mutations are
 applied, they are added to an in-memory change set, and appended to a mutation log file for persistence. On restart,
 the mutation log file (if any) is read to reconstruct the in-memory change set.

 <p>
 <b>Compaction</b>

 <p>
 Instances periodically compact outstanding changes into new array files (and truncate the mutation log file) in a background
 thread. A compaction is scheduled whenever:
  <ul>
  <li>The size of mutation log file exceeds the <a href="#setCompactLowWater(int)">compaction space low-water mark</a></li>
  <li>The oldest uncompacted modification is older than the <a href="#setCompactMaxDelay(int)">compaction maximum delay</a></li>
  <li>The <a href="#scheduleCompaction()"><code>scheduleCompaction()</code></a> method is invoked</li>
  </ul>

 <p>
 In order to prevent compaction from getting hopelessly behind when there is high write volume, a
 <a href="#setCompactHighWater(int)">compaction space high-water mark</a> is also used. When the size of the mutation log file
 exceeds the half-way point between the low-water and high-water marks, new write attempts start being artificially delayed,
 and this delay amount <a href="#calculateCompactionPressureDelay(float)">increases to infinity</a> as the high-water mark is approached,
 so that as long as the high-water mark is exceeded, new writes are blocked completely until the current compaction cycle
 completes. Use <a href="#getTotalMillisWaiting()"><code>getTotalMillisWaiting()</code></a> to asses the total amount of time spent in these artificial delays.

 <p>
 The number of bytes occupied by the in-memory change set and the length of the outstanding mutations log file are
 related. Therefore, the compaction high-water mark loosely correlates to a maximum amount of memory required
 by the in-memory change set.

 <p>
 <b>Hot Backups</b>

 <p>
 "Hot" backups may be created in parallel with normal operation via <a href="#hotCopy(java.io.File)"><code>hotCopy()</code></a>.
 Hard links are used to make this operation fast; only the mutation log file (if any) is actually copied.

 <p>
 The <a href="#setDirectory(java.io.File)">database directory</a> is a required configuration property.

 <p>
 Key and value data must not exceed 2GB (each separately).

 <p>
 Instances may be stopped and (re)started multiple times.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="https://en.wikipedia.org/wiki/Write-ahead_logging">Write-ahead logging</a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final int</code></div>
<div class="col-second even-row-color"><code><a href="#DEFAULT_COMPACTION_HIGH_WATER" class="member-name-link">DEFAULT_COMPACTION_HIGH_WATER</a></code></div>
<div class="col-last even-row-color">
<div class="block">Default compaction space high-water mark in bytes (1073741824 bytes).</div>
</div>
<div class="col-first odd-row-color"><code>static final int</code></div>
<div class="col-second odd-row-color"><code><a href="#DEFAULT_COMPACTION_LOW_WATER" class="member-name-link">DEFAULT_COMPACTION_LOW_WATER</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Default compaction space low-water mark in bytes (65536 bytes).</div>
</div>
<div class="col-first even-row-color"><code>static final int</code></div>
<div class="col-second even-row-color"><code><a href="#DEFAULT_COMPACTION_MAX_DELAY" class="member-name-link">DEFAULT_COMPACTION_MAX_DELAY</a></code></div>
<div class="col-last even-row-color">
<div class="block">Default compaction maximum delay in seconds (86400 seconds).</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">AtomicArrayKVStore</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#adjustCounter(io.permazen.util.ByteData,long)" class="member-name-link">adjustCounter</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key,
 long&nbsp;amount)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Adjust the counter at the given key by the given amount.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#apply(io.permazen.kv.mvcc.Mutations)" class="member-name-link">apply</a><wbr>(<a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc">Mutations</a>&nbsp;mutations)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Apply all the given <a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc"><code>Mutations</code></a> to this instance.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#apply(io.permazen.kv.mvcc.Mutations,boolean)" class="member-name-link">apply</a><wbr>(<a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc">Mutations</a>&nbsp;mutations,
 boolean&nbsp;sync)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Apply a set of mutations to this instance atomically.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#calculateCompactionPressureDelay(float)" class="member-name-link">calculateCompactionPressureDelay</a><wbr>(float&nbsp;windowRatio)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Calculate the maximum amount of time that a thread attempting to <a href="#apply(io.permazen.kv.mvcc.Mutations,boolean)"><code>apply()</code></a>
 mutations must wait for a background compaction to complete as we start nearing the high water mark.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#decodeCounter(io.permazen.util.ByteData)" class="member-name-link">decodeCounter</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;bytes)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Decode a counter value previously encoded by <a href="../KVStore.html#encodeCounter(long)"><code>encodeCounter()</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#encodeCounter(long)" class="member-name-link">encodeCounter</a><wbr>(long&nbsp;value)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Encode a counter value into a <code>byte[]</code> value suitable for use with <a href="../KVStore.html#decodeCounter(io.permazen.util.ByteData)"><code>decodeCounter()</code></a>
 and/or <a href="../KVStore.html#adjustCounter(io.permazen.util.ByteData,long)"><code>adjustCounter()</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#finalize()" class="member-name-link">finalize</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Finalize this instance.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#get(io.permazen.util.ByteData)" class="member-name-link">get</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the value associated with the given key, if any.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getAtLeast(io.permazen.util.ByteData,io.permazen.util.ByteData)" class="member-name-link">getAtLeast</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the key/value pair having the smallest key greater than or equal to the given minimum, if any.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getAtMost(io.permazen.util.ByteData,io.permazen.util.ByteData)" class="member-name-link">getAtMost</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the key/value pair having the largest key strictly less than the given maximum, if any.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getDirectory()" class="member-name-link">getDirectory</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the filesystem directory containing the database.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../util/CloseableIterator.html" title="interface in io.permazen.util">CloseableIterator</a>&lt;<a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getRange(io.permazen.util.ByteData,io.permazen.util.ByteData,boolean)" class="member-name-link">getRange</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey,
 boolean&nbsp;reverse)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Iterate the key/value pairs in the specified range.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getTotalMillisWaiting()" class="member-name-link">getTotalMillisWaiting</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the total number of milliseconds spent in artificial delays caused by waiting for compaction.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#hotCopy(java.io.File)" class="member-name-link">hotCopy</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;target)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Create a filesystem atomic snapshot, or "hot" copy", of this instance in the specified destination directory.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#put(io.permazen.util.ByteData,io.permazen.util.ByteData)" class="member-name-link">put</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;value)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Set the value associated with the given key.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../CloseableKVStore.html" title="interface in io.permazen.kv">CloseableKVStore</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#readOnlySnapshot()" class="member-name-link">readOnlySnapshot</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Create a read-only "snapshot" view of this instance equal to its current state.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#remove(io.permazen.util.ByteData)" class="member-name-link">remove</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Remove the key/value pair with the given key, if it exists.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#removeRange(io.permazen.util.ByteData,io.permazen.util.ByteData)" class="member-name-link">removeRange</a><wbr>(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Remove all key/value pairs whose keys are in a given range.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/Future.html" title="class or interface in java.util.concurrent" class="external-link">Future</a>&lt;?&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#scheduleCompaction()" class="member-name-link">scheduleCompaction</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Schedule a new compaction cycle, unless there is one already scheduled or running, or there are no
 outstanding uncompacted modifications.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setCompactHighWater(int)" class="member-name-link">setCompactHighWater</a><wbr>(int&nbsp;compactHighWater)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the compaction space high-water mark in bytes.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setCompactLowWater(int)" class="member-name-link">setCompactLowWater</a><wbr>(int&nbsp;compactLowWater)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the compaction space low-water mark in bytes.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setCompactMaxDelay(int)" class="member-name-link">setCompactMaxDelay</a><wbr>(int&nbsp;compactMaxDelay)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the compaction time maximum delay.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setDirectory(java.io.File)" class="member-name-link">setDirectory</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;directory)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the filesystem directory containing the database.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setScheduledExecutorService(java.util.concurrent.ScheduledExecutorService)" class="member-name-link">setScheduledExecutorService</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ScheduledExecutorService</a>&nbsp;scheduledExecutorService)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ScheduledExecutorService</code></a> used to schedule background compaction.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#start()" class="member-name-link">start</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Start this instance.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#stop()" class="member-name-link">stop</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Stop this instance.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#toString()" class="member-name-link">toString</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-io.permazen.kv.KVStore">Methods inherited from interface&nbsp;io.permazen.kv.<a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></h3>
<code><a href="../KVStore.html#getRange(io.permazen.kv.KeyRange)">getRange</a>, <a href="../KVStore.html#getRange(io.permazen.util.ByteData,io.permazen.util.ByteData)">getRange</a>, <a href="../KVStore.html#removeRange(io.permazen.kv.KeyRange)">removeRange</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="DEFAULT_COMPACTION_MAX_DELAY">
<h3>DEFAULT_COMPACTION_MAX_DELAY</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">DEFAULT_COMPACTION_MAX_DELAY</span></div>
<div class="block">Default compaction maximum delay in seconds (86400 seconds).</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../constant-values.html#io.permazen.kv.array.AtomicArrayKVStore.DEFAULT_COMPACTION_MAX_DELAY">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="DEFAULT_COMPACTION_LOW_WATER">
<h3>DEFAULT_COMPACTION_LOW_WATER</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">DEFAULT_COMPACTION_LOW_WATER</span></div>
<div class="block">Default compaction space low-water mark in bytes (65536 bytes).</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../constant-values.html#io.permazen.kv.array.AtomicArrayKVStore.DEFAULT_COMPACTION_LOW_WATER">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="DEFAULT_COMPACTION_HIGH_WATER">
<h3>DEFAULT_COMPACTION_HIGH_WATER</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">DEFAULT_COMPACTION_HIGH_WATER</span></div>
<div class="block">Default compaction space high-water mark in bytes (1073741824 bytes).</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../constant-values.html#io.permazen.kv.array.AtomicArrayKVStore.DEFAULT_COMPACTION_HIGH_WATER">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>AtomicArrayKVStore</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">AtomicArrayKVStore</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="getDirectory()">
<h3>getDirectory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a></span>&nbsp;<span class="element-name">getDirectory</span>()</div>
<div class="block">Get the filesystem directory containing the database. If not set, this class functions as an in-memory store.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>database directory, or null for none</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setDirectory(java.io.File)">
<h3>setDirectory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setDirectory</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;directory)</span></div>
<div class="block">Configure the filesystem directory containing the database. If not set, this class functions as an in-memory store.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>directory</code> - database directory, or null for none</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is already <a href="#start()"><code>start()</code></a>ed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setScheduledExecutorService(java.util.concurrent.ScheduledExecutorService)">
<h3>setScheduledExecutorService</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setScheduledExecutorService</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ScheduledExecutorService</a>&nbsp;scheduledExecutorService)</span></div>
<div class="block">Configure the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ScheduledExecutorService</code></a> used to schedule background compaction.

 <p>
 If not explicitly configured, a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ScheduledExecutorService</code></a> will be created automatically during <a href="#start()"><code>start()</code></a>
 using <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/Executors.html#newSingleThreadScheduledExecutor()" title="class or interface in java.util.concurrent" class="external-link"><code>Executors.newSingleThreadScheduledExecutor()</code></a> and shutdown by <a href="#stop()"><code>stop()</code></a> (if explicitly configured here,
 the configured <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" title="class or interface in java.util.concurrent" class="external-link"><code>ScheduledExecutorService</code></a> will not be shutdown by <a href="#stop()"><code>stop()</code></a>).</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>scheduledExecutorService</code> - schduled executor service, or null to have one created automatically</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is already <a href="#start()"><code>start()</code></a>ed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setCompactMaxDelay(int)">
<h3>setCompactMaxDelay</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setCompactMaxDelay</span><wbr><span class="parameters">(int&nbsp;compactMaxDelay)</span></div>
<div class="block">Configure the compaction time maximum delay. Compaction will be automatically triggered whenever there is any
 uncompacted modification older than this.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>compactMaxDelay</code> - compaction time maximum delay in seconds</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>compactMaxDelay</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is already <a href="#start()"><code>start()</code></a>ed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setCompactLowWater(int)">
<h3>setCompactLowWater</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setCompactLowWater</span><wbr><span class="parameters">(int&nbsp;compactLowWater)</span></div>
<div class="block">Configure the compaction space low-water mark in bytes.

 <p>
 This value is applied to the size of the on-disk modifications file.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>compactLowWater</code> - compaction space low-water mark in bytes</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>compactLowWater</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is already <a href="#start()"><code>start()</code></a>ed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setCompactHighWater(int)">
<h3>setCompactHighWater</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setCompactHighWater</span><wbr><span class="parameters">(int&nbsp;compactHighWater)</span></div>
<div class="block">Configure the compaction space high-water mark in bytes.

 <p>
 This value is applied to the size of the on-disk modifications file.

 <p>
 If the compaction space high water mark is set smaller than the the compaction space low water mark,
 then it's treated as if it were the same as the compaction space low water mark.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>compactHighWater</code> - compaction space high-water mark in bytes</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>compactHighWater</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is already <a href="#start()"><code>start()</code></a>ed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getTotalMillisWaiting()">
<h3>getTotalMillisWaiting</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getTotalMillisWaiting</span>()</div>
<div class="block">Get the total number of milliseconds spent in artificial delays caused by waiting for compaction.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>total delay in milliseconds</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="start()">
<h3>start</h3>
<div class="member-signature"><span class="annotations">@PostConstruct
</span><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">start</span>()</div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../mvcc/AtomicKVStore.html#start()">AtomicKVStore</a></code></span></div>
<div class="block">Start this instance. This method must be called prior to creating any transactions.

 <p>
 This method is idempotent: if this instance is already started, nothing happens.

 <p>
 Whether an instance that has been started and stopped can be restarted is implementation-dependent.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../mvcc/AtomicKVStore.html#start()">start</a></code>&nbsp;in interface&nbsp;<code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="stop()">
<h3>stop</h3>
<div class="member-signature"><span class="annotations">@PreDestroy
</span><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">stop</span>()</div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../mvcc/AtomicKVStore.html#stop()">AtomicKVStore</a></code></span></div>
<div class="block">Stop this instance.

 <p>
 Any open <a href="../mvcc/AtomicKVStore.html#readOnlySnapshot()"><code>AtomicKVStore.readOnlySnapshot()</code></a>'s should be <a href="../CloseableKVStore.html#close()"><code>close()</code></a>'d before invoking this method;
 the behavior of those that are not is undefined.

 <p>
 This method is idempotent: if this instance has not been started, or is already stopped, nothing happens.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../mvcc/AtomicKVStore.html#stop()">stop</a></code>&nbsp;in interface&nbsp;<code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="get(io.permazen.util.ByteData)">
<h3>get</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a></span>&nbsp;<span class="element-name">get</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#get(io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Get the value associated with the given key, if any.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#get(io.permazen.util.ByteData)">get</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#get(io.permazen.util.ByteData)">get</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>key</code> - key</dd>
<dt>Returns:</dt>
<dd>value associated with key, or null if not found</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getAtLeast(io.permazen.util.ByteData,io.permazen.util.ByteData)">
<h3>getAtLeast</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a></span>&nbsp;<span class="element-name">getAtLeast</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#getAtLeast(io.permazen.util.ByteData,io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Get the key/value pair having the smallest key greater than or equal to the given minimum, if any.

 <p>
 An optional (exclusive) maximum key may also be specified; if <code>maxKey</code> is null, there is no upper bound;
 if <code>maxKey &lt;= minKey</code>, null is always returned.

 <p>
 If keys starting with <code>0xff</code> are not supported by this instance, and <code>minKey</code> starts with <code>0xff</code>,
 then this method returns null.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#getAtLeast(io.permazen.util.ByteData,io.permazen.util.ByteData)">getAtLeast</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#getAtLeast(io.permazen.util.ByteData,io.permazen.util.ByteData)">getAtLeast</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>minKey</code> - minimum key (inclusive), or null for no minimum (get the smallest key)</dd>
<dd><code>maxKey</code> - maximum key (exclusive), or null for no maximum (no upper bound)</dd>
<dt>Returns:</dt>
<dd>smallest key/value pair with <code>key &gt;= minKey</code> and <code>key &lt; maxKey</code>, or null if none exists</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getAtMost(io.permazen.util.ByteData,io.permazen.util.ByteData)">
<h3>getAtMost</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a></span>&nbsp;<span class="element-name">getAtMost</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#getAtMost(io.permazen.util.ByteData,io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Get the key/value pair having the largest key strictly less than the given maximum, if any.

 <p>
 An optional (inclusive) minimum key may also be specified; if <code>minKey</code> is null, there is no lower bound
 (equivalent to a lower bound of the empty byte array); if <code>minKey &gt;= maxKey</code>, null is always returned.

 <p>
 If keys starting with <code>0xff</code> are not supported by this instance, and <code>maxKey</code> starts with <code>0xff</code>,
 then this method behaves as if <code>maxKey</code> were null.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#getAtMost(io.permazen.util.ByteData,io.permazen.util.ByteData)">getAtMost</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#getAtMost(io.permazen.util.ByteData,io.permazen.util.ByteData)">getAtMost</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>maxKey</code> - maximum key (exclusive), or null for no maximum (get the largest key)</dd>
<dd><code>minKey</code> - minimum key (inclusive), or null for no minimum (no lower bound)</dd>
<dt>Returns:</dt>
<dd>largest key/value pair with <code>key &lt; maxKey</code> and <code>key &gt;= minKey</code>, or null if none exists</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getRange(io.permazen.util.ByteData,io.permazen.util.ByteData,boolean)">
<h3>getRange</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../util/CloseableIterator.html" title="interface in io.permazen.util">CloseableIterator</a>&lt;<a href="../KVPair.html" title="class in io.permazen.kv">KVPair</a>&gt;</span>&nbsp;<span class="element-name">getRange</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey,
 boolean&nbsp;reverse)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#getRange(io.permazen.util.ByteData,io.permazen.util.ByteData,boolean)">KVStore</a></code></span></div>
<div class="block">Iterate the key/value pairs in the specified range. The returned <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a>'s
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html#remove()" title="class or interface in java.util" class="external-link"><code>remove()</code></a> method must be supported and should have the same effect as
 invoking <a href="../KVStore.html#remove(io.permazen.util.ByteData)"><code>remove()</code></a> on the corresponding key.

 <p>
 If keys starting with <code>0xff</code> are not supported by this instance, and <code>minKey</code> starts with <code>0xff</code>,
 then this method returns an empty iteration.

 <p>
 If keys starting with <code>0xff</code> are not supported by this instance, and <code>maxKey</code> starts with <code>0xff</code>,
 then this method behaves as if <code>maxKey</code> were null.

 <p>
 The returned <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a> is <i>weakly consistent</i> (see <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/package-summary.html" class="external-link"><code>java.util.concurrent</code></a>).
 In short, the returned <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a> must not throw <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ConcurrentModificationException.html" title="class or interface in java.util" class="external-link"><code>ConcurrentModificationException</code></a>;
 however, whether or not a "live" <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a> reflects any modifications made after its creation is
 implementation dependent. Implementations that do make post-creation updates visible in the <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a>,
 even if the update occurs after some delay, must preserve the order in which the modifications actually occurred.

 <p>
 The returned <a href="../../util/CloseableIterator.html" title="interface in io.permazen.util"><code>CloseableIterator</code></a> itself is not guaranteed to be thread safe; is should only be used
 in the thread that created it.

 <p>
 Invokers of this method are encouraged to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Closeable.html#close()" title="class or interface in java.io" class="external-link"><code>close()</code></a> the returned iterators,
 though this is not required for correct behavior.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#getRange(io.permazen.util.ByteData,io.permazen.util.ByteData,boolean)">getRange</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>minKey</code> - minimum key (inclusive), or null for no minimum (start at the smallest key)</dd>
<dd><code>maxKey</code> - maximum key (exclusive), or null for no maximum (end at the largest key)</dd>
<dd><code>reverse</code> - true to return key/value pairs in reverse order (i.e., keys descending)</dd>
<dt>Returns:</dt>
<dd>iteration of key/value pairs in the range <code>minKey</code> (inclusive) to <code>maxKey</code> (exclusive)</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="put(io.permazen.util.ByteData,io.permazen.util.ByteData)">
<h3>put</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">put</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;value)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#put(io.permazen.util.ByteData,io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Set the value associated with the given key.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#put(io.permazen.util.ByteData,io.permazen.util.ByteData)">put</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#put(io.permazen.util.ByteData,io.permazen.util.ByteData)">put</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>key</code> - key</dd>
<dd><code>value</code> - value</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="remove(io.permazen.util.ByteData)">
<h3>remove</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">remove</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#remove(io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Remove the key/value pair with the given key, if it exists.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#remove(io.permazen.util.ByteData)">remove</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#remove(io.permazen.util.ByteData)">remove</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>key</code> - key</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="removeRange(io.permazen.util.ByteData,io.permazen.util.ByteData)">
<h3>removeRange</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">removeRange</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;minKey,
 <a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;maxKey)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#removeRange(io.permazen.util.ByteData,io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Remove all key/value pairs whose keys are in a given range.

 <p>
 The <code>minKey</code> must be less than or equal to <code>maxKey</code>; if they equal (and not null)
 then nothing happens; if they are both null then all entries are deleted.

 <p>
 If keys starting with <code>0xff</code> are not supported by this instance, then:
 <ul>
  <li>If <code>minKey</code> starts with <code>0xff</code>, then no change occurs</li>
  <li>If <code>maxKey</code> starts with <code>0xff</code>, then this method behaves as if <code>maxKey</code> were null</li>
 </ul></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#removeRange(io.permazen.util.ByteData,io.permazen.util.ByteData)">removeRange</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#removeRange(io.permazen.util.ByteData,io.permazen.util.ByteData)">removeRange</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>minKey</code> - minimum key (inclusive), or null for no minimum</dd>
<dd><code>maxKey</code> - maximum key (exclusive), or null for no maximum</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="adjustCounter(io.permazen.util.ByteData,long)">
<h3>adjustCounter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">adjustCounter</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;key,
 long&nbsp;amount)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#adjustCounter(io.permazen.util.ByteData,long)">KVStore</a></code></span></div>
<div class="block">Adjust the counter at the given key by the given amount.

 <p>
 Ideally this operation should behave in a lock-free manner, so that concurrent transactions can invoke it without
 conflict. However, when lock-free behavior occurs (if at all) depends on the implementation.

 <p>
 If there is no value associated with <code>key</code>, or <code>key</code>'s value is not a valid counter encoding as
 would be acceptable to <a href="../KVStore.html#decodeCounter(io.permazen.util.ByteData)"><code>decodeCounter()</code></a>, then how this operation affects <code>key</code>'s
 value is undefined.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#adjustCounter(io.permazen.util.ByteData,long)">adjustCounter</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#adjustCounter(io.permazen.util.ByteData,long)">adjustCounter</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>key</code> - key</dd>
<dd><code>amount</code> - amount to adjust counter value by</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="encodeCounter(long)">
<h3>encodeCounter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a></span>&nbsp;<span class="element-name">encodeCounter</span><wbr><span class="parameters">(long&nbsp;value)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#encodeCounter(long)">KVStore</a></code></span></div>
<div class="block">Encode a counter value into a <code>byte[]</code> value suitable for use with <a href="../KVStore.html#decodeCounter(io.permazen.util.ByteData)"><code>decodeCounter()</code></a>
 and/or <a href="../KVStore.html#adjustCounter(io.permazen.util.ByteData,long)"><code>adjustCounter()</code></a>.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#encodeCounter(long)">encodeCounter</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#encodeCounter(long)">encodeCounter</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>value</code> - desired counter value</dd>
<dt>Returns:</dt>
<dd>encoded counter value</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="decodeCounter(io.permazen.util.ByteData)">
<h3>decodeCounter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">decodeCounter</span><wbr><span class="parameters">(<a href="../../util/ByteData.html" title="class in io.permazen.util">ByteData</a>&nbsp;bytes)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVStore.html#decodeCounter(io.permazen.util.ByteData)">KVStore</a></code></span></div>
<div class="block">Decode a counter value previously encoded by <a href="../KVStore.html#encodeCounter(long)"><code>encodeCounter()</code></a>.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#decodeCounter(io.permazen.util.ByteData)">decodeCounter</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="../AbstractKVStore.html#decodeCounter(io.permazen.util.ByteData)">decodeCounter</a></code>&nbsp;in class&nbsp;<code><a href="../AbstractKVStore.html" title="class in io.permazen.kv">AbstractKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>bytes</code> - encoded counter value</dd>
<dt>Returns:</dt>
<dd>decoded counter value</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="apply(io.permazen.kv.mvcc.Mutations)">
<h3>apply</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">apply</span><wbr><span class="parameters">(<a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc">Mutations</a>&nbsp;mutations)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../mvcc/AtomicKVStore.html#apply(io.permazen.kv.mvcc.Mutations)">AtomicKVStore</a></code></span></div>
<div class="block">Apply all the given <a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc"><code>Mutations</code></a> to this instance.

 <p>
 Equivalent to: <a href="../mvcc/AtomicKVStore.html#apply(io.permazen.kv.mvcc.Mutations,boolean)"><code>apply</code></a><code>(mutations, false)</code>.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../mvcc/AtomicKVStore.html#apply(io.permazen.kv.mvcc.Mutations)">apply</a></code>&nbsp;in interface&nbsp;<code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
<dt>Specified by:</dt>
<dd><code><a href="../KVStore.html#apply(io.permazen.kv.mvcc.Mutations)">apply</a></code>&nbsp;in interface&nbsp;<code><a href="../KVStore.html" title="interface in io.permazen.kv">KVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>mutations</code> - mutations to apply</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="readOnlySnapshot()">
<h3>readOnlySnapshot</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../CloseableKVStore.html" title="interface in io.permazen.kv">CloseableKVStore</a></span>&nbsp;<span class="element-name">readOnlySnapshot</span>()</div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../mvcc/AtomicKVStore.html#readOnlySnapshot()">AtomicKVStore</a></code></span></div>
<div class="block">Create a read-only "snapshot" view of this instance equal to its current state.

 <p>
 The returned <a href="../CloseableKVStore.html" title="interface in io.permazen.kv"><code>CloseableKVStore</code></a> should be treated as read-only. It may not actually be read-only,
 but if it's not, then any changes should have no effect on this instance. The returned <a href="../CloseableKVStore.html" title="interface in io.permazen.kv"><code>CloseableKVStore</code></a>
 must be completely independent from this instance (subsequent changes to either one do not affect the other).

 <p>
 The returned <a href="../CloseableKVStore.html" title="interface in io.permazen.kv"><code>CloseableKVStore</code></a> should be promply <a href="../CloseableKVStore.html#close()"><code>close()</code></a>'d when no longer
 needed to release any underlying resources.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../mvcc/AtomicKVStore.html#readOnlySnapshot()">readOnlySnapshot</a></code>&nbsp;in interface&nbsp;<code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
<dt>Returns:</dt>
<dd>read-only, snapshot view of this instance</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="apply(io.permazen.kv.mvcc.Mutations,boolean)">
<h3>apply</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">apply</span><wbr><span class="parameters">(<a href="../mvcc/Mutations.html" title="interface in io.permazen.kv.mvcc">Mutations</a>&nbsp;mutations,
 boolean&nbsp;sync)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../mvcc/AtomicKVStore.html#apply(io.permazen.kv.mvcc.Mutations,boolean)">AtomicKVStore</a></code></span></div>
<div class="block">Apply a set of mutations to this instance atomically.

 <p>
 If this method returns normally, all of the given mutations will have been applied. If this method
 returns abnormally, then none of the given mutations will have been applied.

 <p>
 In any case, other threads observing this instance will never see a partial application of the given mutations.

 <p>
 This method is required to apply the mutations in this order: removes, puts, adjusts.

 <p>
 If <code>sync</code> is true, the implementation must durably persist the changes before returning.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../mvcc/AtomicKVStore.html#apply(io.permazen.kv.mvcc.Mutations,boolean)">apply</a></code>&nbsp;in interface&nbsp;<code><a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc">AtomicKVStore</a></code></dd>
<dt>Parameters:</dt>
<dd><code>mutations</code> - the mutations to apply</dd>
<dd><code>sync</code> - if true, caller requires that the changes be durably persisted</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="hotCopy(java.io.File)">
<h3>hotCopy</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">hotCopy</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;target)</span>
             throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Create a filesystem atomic snapshot, or "hot" copy", of this instance in the specified destination directory.
 The copy will be up-to-date as of the time this method is invoked.

 <p>
 The <code>target</code> directory will be created if it does not exist; otherwise, it must be empty.
 All files except the uncompacted modifications file are copied into <code>target</code>
 in constant time using <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/file/Files.html#createLink(java.nio.file.Path,java.nio.file.Path)" title="class or interface in java.nio.file" class="external-link">hard links</a> if possible.

 <p>
 The hot copy operation can proceed in parallel with normal database activity, with the exception
 that the compaction operation cannot start while there are concurrent hot copies in progress.

 <p>
 Therefore, for best performance, consider <a href="#scheduleCompaction()">performing a compaction</a>
 immediately prior to this operation.

 <p>
 Note: when this method returns, all copied files, and the <code>target</code> directory, have been <code>fsync()</code>'d
 and therefore may be considered durable in case of a system crash.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>target</code> - destination directory</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code> - if an I/O error occurs</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>target</code> exists and is not a directory or is non-empty</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>target</code> is null</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="calculateCompactionPressureDelay(float)">
<h3>calculateCompactionPressureDelay</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">calculateCompactionPressureDelay</span><wbr><span class="parameters">(float&nbsp;windowRatio)</span></div>
<div class="block">Calculate the maximum amount of time that a thread attempting to <a href="#apply(io.permazen.kv.mvcc.Mutations,boolean)"><code>apply()</code></a>
 mutations must wait for a background compaction to complete as we start nearing the high water mark.

 <p>
 The implementation in <a href="AtomicArrayKVStore.html" title="class in io.permazen.kv.array"><code>AtomicArrayKVStore</code></a> returns <code>-1</code> for all values below 50%,
 and then scales according to an inverse power function returning zero at 50%, 100ms at 75%,
 and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html#MAX_VALUE" title="class or interface in java.lang" class="external-link"><code>Long.MAX_VALUE</code></a> at 100%.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>windowRatio</code> - the uncompacted mutation size as a fraction of the interval between low and high
  water marks; always a value value between zero and one (exclusive)</dd>
<dt>Returns:</dt>
<dd>negative value for no delay, zero or positive value to trigger a background compaction
  (if not already running) and wait up to that many milliseconds for it to complete</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="scheduleCompaction()">
<h3>scheduleCompaction</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/Future.html" title="class or interface in java.util.concurrent" class="external-link">Future</a>&lt;?&gt;</span>&nbsp;<span class="element-name">scheduleCompaction</span>()</div>
<div class="block">Schedule a new compaction cycle, unless there is one already scheduled or running, or there are no
 outstanding uncompacted modifications.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>a future for the completion of the next compaction cycle, or null if there are no uncompacted modifications</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html" title="class or interface in java.lang" class="external-link">IllegalStateException</a></code> - if this instance is not started</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="finalize()">
<h3>finalize</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">finalize</span>()
                 throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Throwable.html" title="class or interface in java.lang" class="external-link">Throwable</a></span></div>
<div class="block">Finalize this instance. Invokes <a href="#stop()"><code>stop()</code></a> to close any unclosed iterators.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a></code>&nbsp;in class&nbsp;<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Throwable.html" title="class or interface in java.lang" class="external-link">Throwable</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="toString()">
<h3>toString</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">toString</span>()</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a></code>&nbsp;in class&nbsp;<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2024. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
