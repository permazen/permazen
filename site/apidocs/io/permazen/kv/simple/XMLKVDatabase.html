<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>XMLKVDatabase (Permazen 5.2.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: io.permazen.kv.simple, class: XMLKVDatabase">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/XMLKVDatabase.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.permazen.kv.simple</a></div>
<h1 title="Class XMLKVDatabase" class="title">Class XMLKVDatabase</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance"><a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">io.permazen.kv.simple.SimpleKVDatabase</a>
<div class="inheritance"><a href="MemoryKVDatabase.html" title="class in io.permazen.kv.simple">io.permazen.kv.simple.MemoryKVDatabase</a>
<div class="inheritance">io.permazen.kv.simple.XMLKVDatabase</div>
</div>
</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="../KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a></code>, <code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Serializable.html" title="class or interface in java.io" class="external-link">Serializable</a></code></dd>
</dl>
<dl class="notes">
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="../../spring/SpringXMLKVDatabase.html" title="class in io.permazen.spring">SpringXMLKVDatabase</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">XMLKVDatabase</span>
<span class="extends-implements">extends <a href="MemoryKVDatabase.html" title="class in io.permazen.kv.simple">MemoryKVDatabase</a></span></div>
<div class="block">A <a href="MemoryKVDatabase.html" title="class in io.permazen.kv.simple"><code>MemoryKVDatabase</code></a> made persistent by storing its XML content in a file or custom <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>StreamRepository</code></a>.

 <p>
 The database XML is rewritten in its entirety after each successful commit, so this class should not be used
 for high-performance applications.

 <p>
 The XML is persisted in a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>StreamRepository</code></a> which provides atomicity and any durability. When constructed
 with a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link"><code>File</code></a> for persistence, that file gets wrapped in a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>FileStreamRepository</code></a>.

 <p><b>Initial Content</b>

 <p>
 At startup, if a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/FileNotFoundException.html" title="class or interface in java.io" class="external-link"><code>FileNotFoundException</code></a> is caught when trying to read the XML, we assume that the underlying
 data has not yet been created and so the database is initialized as empty. Alternatively, you can configure some
 default initial content for this scenario via <a href="#setInitialContentFile(java.io.File)"><code>setInitialContentFile()</code></a>, or by overriding
 <a href="#getInitialContent()"><code>getInitialContent()</code></a>.

 <p><b>Out-Of-Band Updates</b>

 <p>
 When a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>FileStreamRepository</code></a> is used, instances support "out-of-band" updates of the XML file. In that case,
 each time a transaction is accessed the modification timestamp of the XML file is examined. If the XML file has been
 updated by some external process since the time the transaction was created, the database will be reloaded from
 the XML file and the transaction will fail with a <a href="../RetryKVTransactionException.html" title="class in io.permazen.kv"><code>RetryKVTransactionException</code></a>.

 <p>
 Note that "out-of-band" updates are not without race conditions: e.g., it's possible for an external process to update
 the XML file just as a transaction associated with this instance is being committed and written to the file, which will
 result in overwriting the external process' changes.

 <p>
 <a href="SimpleKVTransaction.html#watchKey(io.permazen.util.ByteData)">Key watches</a> are supported.

 <p>
 Instances are serializable unless a non-serializable <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>StreamRepository</code></a> is provided to the constructor.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../util/XMLSerializer.html" title="class in io.permazen.kv.util"><code>XMLSerializer</code></a></li>
<li><a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/AtomicUpdateFileOutputStream.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>AtomicUpdateFileOutputStream</code></a></li>
<li><a href="../../spring/SpringXMLKVDatabase.html" title="class in io.permazen.spring"><code>SpringXMLKVDatabase</code></a></li>
<li><a href="../../../../serialized-form.html#io.permazen.kv.simple.XMLKVDatabase">Serialized Form</a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-io.permazen.kv.simple.SimpleKVDatabase">Fields inherited from class&nbsp;io.permazen.kv.simple.<a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></h3>
<code><a href="SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT">DEFAULT_HOLD_TIMEOUT</a>, <a href="SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT">DEFAULT_WAIT_TIMEOUT</a>, <a href="SimpleKVDatabase.html#kv">kv</a>, <a href="SimpleKVDatabase.html#log">log</a></code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(java.io.File)" class="member-name-link">XMLKVDatabase</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;file)</code></div>
<div class="col-last even-row-color">
<div class="block">Constructor.</div>
</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(java.io.File,long,long)" class="member-name-link">XMLKVDatabase</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;file,
 long&nbsp;waitTimeout,
 long&nbsp;holdTimeout)</code></div>
<div class="col-last odd-row-color">
<div class="block">Constructor.</div>
</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.dellroad.stuff.io.StreamRepository)" class="member-name-link">XMLKVDatabase</a><wbr>(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link">StreamRepository</a>&nbsp;repository)</code></div>
<div class="col-last even-row-color">
<div class="block">Constructor.</div>
</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(org.dellroad.stuff.io.StreamRepository,long,long)" class="member-name-link">XMLKVDatabase</a><wbr>(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link">StreamRepository</a>&nbsp;repository,
 long&nbsp;waitTimeout,
 long&nbsp;holdTimeout)</code></div>
<div class="col-last odd-row-color">
<div class="block">Constructor.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkForOutOfBandUpdate()" class="member-name-link">checkForOutOfBandUpdate</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Check the XML file's timestamp and reload it if it has been modified since the most recent
 read or write by this instance.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkState(io.permazen.kv.simple.SimpleKVTransaction)" class="member-name-link">checkState</a><wbr>(<a href="SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Verify that the given transaction is still usable.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="XMLKVTransaction.html" title="class in io.permazen.kv.simple">XMLKVTransaction</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#createTransaction()" class="member-name-link">createTransaction</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Create a new transaction.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getGeneration()" class="member-name-link">getGeneration</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the generation number associated with the XML file.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/InputStream.html" title="class or interface in java.io" class="external-link">InputStream</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getInitialContent()" class="member-name-link">getInitialContent</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the initial content for an uninitialized database.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#postCommit(io.permazen.kv.simple.SimpleKVTransaction,boolean)" class="member-name-link">postCommit</a><wbr>(<a href="SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx,
 boolean&nbsp;successful)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Invoked during transaction commit just after writing changes to the underlying <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#readXML()" class="member-name-link">readXML</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#reload()" class="member-name-link">reload</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Forcibly reload this database by re-reading the XML file.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setInitialContentFile(java.io.File)" class="member-name-link">setInitialContentFile</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;initialContentFile)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Configure the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link"><code>File</code></a> containing default initial content for an uninitialized database.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#start()" class="member-name-link">start</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Start this instance.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#writeXML()" class="member-name-link">writeXML</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-io.permazen.kv.simple.SimpleKVDatabase">Methods inherited from class&nbsp;io.permazen.kv.simple.<a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></h3>
<code><a href="SimpleKVDatabase.html#createTransaction(java.util.Map)">createTransaction</a>, <a href="SimpleKVDatabase.html#getHoldTimeout()">getHoldTimeout</a>, <a href="SimpleKVDatabase.html#getWaitTimeout()">getWaitTimeout</a>, <a href="SimpleKVDatabase.html#preCommit(io.permazen.kv.simple.SimpleKVTransaction)">preCommit</a>, <a href="SimpleKVDatabase.html#setHoldTimeout(long)">setHoldTimeout</a>, <a href="SimpleKVDatabase.html#setWaitTimeout(long)">setWaitTimeout</a>, <a href="SimpleKVDatabase.html#stop()">stop</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(java.io.File)">
<h3>XMLKVDatabase</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">XMLKVDatabase</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;file)</span></div>
<div class="block">Constructor.

 <p>
 Uses a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>FileStreamRepository</code></a> backed by the specified file, with timeouts set to
 <a href="SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_WAIT_TIMEOUT</code></a> and <a href="SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_HOLD_TIMEOUT</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>file</code> - persistent XML file</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>file</code> is null</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(java.io.File,long,long)">
<h3>XMLKVDatabase</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">XMLKVDatabase</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;file,
 long&nbsp;waitTimeout,
 long&nbsp;holdTimeout)</span></div>
<div class="block">Constructor.

 <p>
 Uses a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>FileStreamRepository</code></a> backed by the specified file with configurable lock timeouts.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>file</code> - persistent XML file</dd>
<dd><code>waitTimeout</code> - how long a thread will wait for a lock before throwing <a href="../RetryKVTransactionException.html" title="class in io.permazen.kv"><code>RetryKVTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dd><code>holdTimeout</code> - how long a thread may hold a contestested lock before throwing <a href="../RetryKVTransactionException.html" title="class in io.permazen.kv"><code>RetryKVTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>waitTimeout</code> or <code>holdTimeout</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>file</code> is null</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(org.dellroad.stuff.io.StreamRepository)">
<h3>XMLKVDatabase</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">XMLKVDatabase</span><wbr><span class="parameters">(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link">StreamRepository</a>&nbsp;repository)</span></div>
<div class="block">Constructor.

 <p>
 Allows storage in any user-supplied <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>StreamRepository</code></a>, with timeouts set to
 <a href="SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_WAIT_TIMEOUT</code></a> and <a href="SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_HOLD_TIMEOUT</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>repository</code> - XML file storage</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>repository</code> is null</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(org.dellroad.stuff.io.StreamRepository,long,long)">
<h3>XMLKVDatabase</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">XMLKVDatabase</span><wbr><span class="parameters">(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link">StreamRepository</a>&nbsp;repository,
 long&nbsp;waitTimeout,
 long&nbsp;holdTimeout)</span></div>
<div class="block">Constructor.

 <p>
 Allows storage in any user-supplied <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html" title="class or interface in org.dellroad.stuff.io" class="external-link"><code>StreamRepository</code></a> with configurable lock timeouts.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>repository</code> - XML file storage</dd>
<dd><code>waitTimeout</code> - how long a thread will wait for a lock before throwing <a href="../RetryKVTransactionException.html" title="class in io.permazen.kv"><code>RetryKVTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dd><code>holdTimeout</code> - how long a thread may hold a contestested lock before throwing <a href="../RetryKVTransactionException.html" title="class in io.permazen.kv"><code>RetryKVTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>waitTimeout</code> or <code>holdTimeout</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if <code>repository</code> is null</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="getInitialContent()">
<h3>getInitialContent</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/InputStream.html" title="class or interface in java.io" class="external-link">InputStream</a></span>&nbsp;<span class="element-name">getInitialContent</span>()
                                 throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Get the initial content for an uninitialized database. This method is invoked when, on the first load,
 the backing XML file is not found. It should return a stream that reads initial content for the database,
 if any, otherwise null.

 <p>
 The implementation in <a href="XMLKVDatabase.html" title="class in io.permazen.kv.simple"><code>XMLKVDatabase</code></a> opens and returns the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link"><code>File</code></a> configured by
 <a href="#setInitialContentFile(java.io.File)"><code>setInitialContentFile()</code></a>, if any, otherwise null.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>default initial XML database content, or null for none</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code> - if an error occurs accessing the initial content file</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setInitialContentFile(java.io.File)">
<h3>setInitialContentFile</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setInitialContentFile</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link">File</a>&nbsp;initialContentFile)</span></div>
<div class="block">Configure the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/File.html" title="class or interface in java.io" class="external-link"><code>File</code></a> containing default initial content for an uninitialized database. This method is invoked
 by <a href="#getInitialContent()"><code>getInitialContent()</code></a> when, on the first load, the backing XML file is not found.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>initialContentFile</code> - file containing default initial XML database content, or null for none</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="start()">
<h3>start</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">start</span>()</div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVDatabase.html#start()">KVDatabase</a></code></span></div>
<div class="block">Start this instance. This method must be called prior to creating any transactions.

 <p>
 This method is idempotent: if this instance is already started, nothing happens.

 <p>
 Whether an instance that has been started and stopped can be restarted is implementation-dependent.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVDatabase.html#start()">start</a></code>&nbsp;in interface&nbsp;<code><a href="../KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="SimpleKVDatabase.html#start()">start</a></code>&nbsp;in class&nbsp;<code><a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="createTransaction()">
<h3>createTransaction</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="XMLKVTransaction.html" title="class in io.permazen.kv.simple">XMLKVTransaction</a></span>&nbsp;<span class="element-name">createTransaction</span>()</div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="../KVDatabase.html#createTransaction()">KVDatabase</a></code></span></div>
<div class="block">Create a new transaction.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../KVDatabase.html#createTransaction()">createTransaction</a></code>&nbsp;in interface&nbsp;<code><a href="../KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a></code></dd>
<dt>Overrides:</dt>
<dd><code><a href="SimpleKVDatabase.html#createTransaction()">createTransaction</a></code>&nbsp;in class&nbsp;<code><a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt>Returns:</dt>
<dd>newly created transaction</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="reload()">
<h3>reload</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">reload</span>()</div>
<div class="block">Forcibly reload this database by re-reading the XML file.

 <p>
 Any transactions that are in-progress when this method is called immediately become unusable.</div>
</section>
</li>
<li>
<section class="detail" id="getGeneration()">
<h3>getGeneration</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">getGeneration</span>()</div>
<div class="block">Get the generation number associated with the XML file.
 The generation number is incremented every time the database is wholesale updated by reading the file into memory,
 e.g., by invoking <a href="#reload()"><code>reload()</code></a>.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>XML file generation number</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list-long">
<li><a href="XMLKVTransaction.html#getGeneration()"><code>XMLKVTransaction.getGeneration()</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkForOutOfBandUpdate()">
<h3>checkForOutOfBandUpdate</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">checkForOutOfBandUpdate</span>()</div>
<div class="block">Check the XML file's timestamp and reload it if it has been modified since the most recent
 read or write by this instance.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>true if file was updated and re-read, otherwise false</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkState(io.permazen.kv.simple.SimpleKVTransaction)">
<h3>checkState</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">checkState</span><wbr><span class="parameters">(<a href="SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="SimpleKVDatabase.html#checkState(io.permazen.kv.simple.SimpleKVTransaction)">SimpleKVDatabase</a></code></span></div>
<div class="block">Verify that the given transaction is still usable.

 <p>
 This method is invoked at the start of the <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a> data access and <a href="SimpleKVTransaction.html#commit()"><code>commit()</code></a>
 methods of the <a href="SimpleKVTransaction.html" title="class in io.permazen.kv.simple"><code>SimpleKVTransaction</code></a> associated with this instance. This allows for any checks which depend on
 a consistent view of the transaction and database together. This instance's lock will be held when this method is invoked.
 Note: transaction state is also protected by this instance's lock.

 <p>
 The implementation in <a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> does nothing.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="SimpleKVDatabase.html#checkState(io.permazen.kv.simple.SimpleKVTransaction)">checkState</a></code>&nbsp;in class&nbsp;<code><a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt>Parameters:</dt>
<dd><code>tx</code> - the transaction being accessed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="postCommit(io.permazen.kv.simple.SimpleKVTransaction,boolean)">
<h3>postCommit</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">postCommit</span><wbr><span class="parameters">(<a href="SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx,
 boolean&nbsp;successful)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="SimpleKVDatabase.html#postCommit(io.permazen.kv.simple.SimpleKVTransaction,boolean)">SimpleKVDatabase</a></code></span></div>
<div class="block">Invoked during transaction commit just after writing changes to the underlying <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a>.

 <p>
 <a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> guarantees this method and <a href="SimpleKVDatabase.html#preCommit(io.permazen.kv.simple.SimpleKVTransaction)"><code>preCommit()</code></a> will be invoked in matching pairs,
 and that this instance will be locked when these methods are invoked.

 <p>
 This method is invoked even if the underlying <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a> throws an exception while changes were being
 written to it. In that case, <code>successful</code> will be false.

 <p>
 The implementation in <a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> does nothing.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="SimpleKVDatabase.html#postCommit(io.permazen.kv.simple.SimpleKVTransaction,boolean)">postCommit</a></code>&nbsp;in class&nbsp;<code><a href="SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt>Parameters:</dt>
<dd><code>tx</code> - the transaction that was committed</dd>
<dd><code>successful</code> - true if all changes were written back successfully,
  false if the underlying <a href="../mvcc/AtomicKVStore.html" title="interface in io.permazen.kv.mvcc"><code>AtomicKVStore</code></a> threw an exception during commit update</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="readXML()">
<h3>readXML</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">readXML</span>()</div>
</section>
</li>
<li>
<section class="detail" id="writeXML()">
<h3>writeXML</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">writeXML</span>()</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2025. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
