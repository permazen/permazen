<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>XMLKVDatabase (Permazen 4.1.9 API)</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="XMLKVDatabase (Permazen 4.1.9 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/XMLKVDatabase.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/permazen/kv/simple/XMLKVImplementation.html" title="class in io.permazen.kv.simple"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/permazen/kv/simple/XMLKVDatabase.html" target="_top">Frames</a></li>
<li><a href="XMLKVDatabase.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.io.permazen.kv.simple.SimpleKVDatabase">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.permazen.kv.simple</div>
<h2 title="Class XMLKVDatabase" class="title">Class XMLKVDatabase</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">io.permazen.kv.simple.SimpleKVDatabase</a></li>
<li>
<ul class="inheritance">
<li>io.permazen.kv.simple.XMLKVDatabase</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../io/permazen/kv/KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html?is-external=true" title="class or interface in java.io">Serializable</a></dd>
</dl>
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><a href="../../../../io/permazen/spring/SpringXMLKVDatabase.html" title="class in io.permazen.spring">SpringXMLKVDatabase</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">XMLKVDatabase</span>
extends <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></pre>
<div class="block">Simple persistent <a href="../../../../io/permazen/kv/KVDatabase.html" title="interface in io.permazen.kv"><code>KVDatabase</code></a> backed by an XML file stored in a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>StreamRepository</code></a>.
 The data is kept in memory, and the XML file is rewritten in its entirety after each successful commit.
 In normal usage, the XML file is stored in a regular <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io"><code>File</code></a> using a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>FileStreamRepository</code></a>, which
 guarantees (via the use of <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/AtomicUpdateFileOutputStream.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>AtomicUpdateFileOutputStream</code></a>) that a partially written XML file can never exist.

 <p>
 If a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/FileNotFoundException.html?is-external=true" title="class or interface in java.io"><code>FileNotFoundException</code></a> is caught when trying to read the XML file, we assume that the underlying file has
 not yet been created and the database will initially be empty. Alternately, you can configure a file containing
 default initial content via <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#setInitialContentFile-java.io.File-"><code>setInitialContentFile()</code></a>, or override <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#getInitialContent--"><code>getInitialContent()</code></a>
 to create the initial content more dynamically.

 <p>
 When a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>FileStreamRepository</code></a> is used, instances support "out-of-band" updates of the XML file. In that case,
 each time a transaction is accessed the modification timestamp of the XML file is examined. If the XML file has been
 updated by some external process since the time the transaction was created, the database will be reloaded from
 the XML file and the transaction will fail with a <a href="../../../../io/permazen/kv/RetryTransactionException.html" title="class in io.permazen.kv"><code>RetryTransactionException</code></a>.

 <p>
 Note that two different processes modifying the XML file at the same time is not without race conditions: e.g., it's possible
 for an external process to update the XML file just as a transaction associated with this instance is being committed
 and written to the file, which will result in overwriting the external process' changes.

 <p>
 <a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html#watchKey-byte:A-">Key watches</a> are supported.

 <p>
 Instances are serializable unless a non-serializable <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>StreamRepository</code></a> is provided to the constructor.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../io/permazen/kv/util/XMLSerializer.html" title="class in io.permazen.kv.util"><code>XMLSerializer</code></a>, 
<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/AtomicUpdateFileOutputStream.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>AtomicUpdateFileOutputStream</code></a>, 
<a href="../../../../io/permazen/spring/SpringXMLKVDatabase.html" title="class in io.permazen.spring"><code>SpringXMLKVDatabase</code></a>, 
<a href="../../../../serialized-form.html#io.permazen.kv.simple.XMLKVDatabase">Serialized Form</a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.io.permazen.kv.simple.SimpleKVDatabase">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;io.permazen.kv.simple.<a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></h3>
<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT">DEFAULT_HOLD_TIMEOUT</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT">DEFAULT_WAIT_TIMEOUT</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#kv">kv</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#log">log</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#XMLKVDatabase-java.io.File-">XMLKVDatabase</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)</code>
<div class="block">Constructor.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#XMLKVDatabase-java.io.File-long-long-">XMLKVDatabase</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file,
             long&nbsp;waitTimeout,
             long&nbsp;holdTimeout)</code>
<div class="block">Constructor.</div>
</td>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#XMLKVDatabase-org.dellroad.stuff.io.StreamRepository-">XMLKVDatabase</a></span>(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io">StreamRepository</a>&nbsp;repository)</code>
<div class="block">Constructor.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#XMLKVDatabase-org.dellroad.stuff.io.StreamRepository-long-long-">XMLKVDatabase</a></span>(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io">StreamRepository</a>&nbsp;repository,
             long&nbsp;waitTimeout,
             long&nbsp;holdTimeout)</code>
<div class="block">Constructor.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#checkForOutOfBandUpdate--">checkForOutOfBandUpdate</a></span>()</code>
<div class="block">Check the XML file's timestamp and reload it if it has been modified since the most recent
 read or write by this instance.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#checkState-io.permazen.kv.simple.SimpleKVTransaction-">checkState</a></span>(<a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx)</code>
<div class="block">Verify that the given transaction is still usable.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../../../io/permazen/kv/simple/XMLKVTransaction.html" title="class in io.permazen.kv.simple">XMLKVTransaction</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#createTransaction--">createTransaction</a></span>()</code>
<div class="block">Create a new transaction.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#getGeneration--">getGeneration</a></span>()</code>
<div class="block">Get the generation number associated with the XML file.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>protected <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html?is-external=true" title="class or interface in java.io">InputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#getInitialContent--">getInitialContent</a></span>()</code>
<div class="block">Get the initial content for an uninitialized database.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#postCommit-io.permazen.kv.simple.SimpleKVTransaction-boolean-">postCommit</a></span>(<a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx,
          boolean&nbsp;successful)</code>
<div class="block">Invoked during transaction commit just after writing changes to the underlying <a href="../../../../io/permazen/kv/KVStore.html" title="interface in io.permazen.kv"><code>KVStore</code></a>.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#readXML--">readXML</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#reload--">reload</a></span>()</code>
<div class="block">Forcibly reload this database by re-reading the XML file.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#setInitialContentFile-java.io.File-">setInitialContentFile</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;initialContentFile)</code>
<div class="block">Configure the <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io"><code>File</code></a> containing default initial content for an uninitialized database.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#start--">start</a></span>()</code>
<div class="block">Start this instance.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#writeXML--">writeXML</a></span>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.io.permazen.kv.simple.SimpleKVDatabase">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;io.permazen.kv.simple.<a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></h3>
<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#createTransaction-java.util.Map-">createTransaction</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#getHoldTimeout--">getHoldTimeout</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#getWaitTimeout--">getWaitTimeout</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#preCommit-io.permazen.kv.simple.SimpleKVTransaction-">preCommit</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#setHoldTimeout-long-">setHoldTimeout</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#setWaitTimeout-long-">setWaitTimeout</a>, <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#stop--">stop</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="XMLKVDatabase-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>XMLKVDatabase</h4>
<pre>public&nbsp;XMLKVDatabase(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)</pre>
<div class="block">Constructor.

 <p>
 Uses a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>FileStreamRepository</code></a> backed by the specified file, with timeouts set to
 <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_WAIT_TIMEOUT</code></a> and <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_HOLD_TIMEOUT</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>file</code> - persistent XML file</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>file</code> is null</dd>
</dl>
</li>
</ul>
<a name="XMLKVDatabase-java.io.File-long-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>XMLKVDatabase</h4>
<pre>public&nbsp;XMLKVDatabase(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file,
                     long&nbsp;waitTimeout,
                     long&nbsp;holdTimeout)</pre>
<div class="block">Constructor.

 <p>
 Uses a <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/FileStreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>FileStreamRepository</code></a> backed by the specified file with configurable lock timeouts.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>file</code> - persistent XML file</dd>
<dd><code>waitTimeout</code> - how long a thread will wait for a lock before throwing <a href="../../../../io/permazen/kv/RetryTransactionException.html" title="class in io.permazen.kv"><code>RetryTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dd><code>holdTimeout</code> - how long a thread may hold a contestested lock before throwing <a href="../../../../io/permazen/kv/RetryTransactionException.html" title="class in io.permazen.kv"><code>RetryTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>waitTimeout</code> or <code>holdTimeout</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>file</code> is null</dd>
</dl>
</li>
</ul>
<a name="XMLKVDatabase-org.dellroad.stuff.io.StreamRepository-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>XMLKVDatabase</h4>
<pre>public&nbsp;XMLKVDatabase(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io">StreamRepository</a>&nbsp;repository)</pre>
<div class="block">Constructor.

 <p>
 Allows storage in any user-supplied <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>StreamRepository</code></a>, with timeouts set to
 <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_WAIT_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_WAIT_TIMEOUT</code></a> and <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#DEFAULT_HOLD_TIMEOUT"><code>SimpleKVDatabase.DEFAULT_HOLD_TIMEOUT</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>repository</code> - XML file storage</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>repository</code> is null</dd>
</dl>
</li>
</ul>
<a name="XMLKVDatabase-org.dellroad.stuff.io.StreamRepository-long-long-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>XMLKVDatabase</h4>
<pre>public&nbsp;XMLKVDatabase(<a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io">StreamRepository</a>&nbsp;repository,
                     long&nbsp;waitTimeout,
                     long&nbsp;holdTimeout)</pre>
<div class="block">Constructor.

 <p>
 Allows storage in any user-supplied <a href="https://archiecobbs.github.io/dellroad-stuff/site/apidocs/org/dellroad/stuff/io/StreamRepository.html?is-external=true" title="class or interface in org.dellroad.stuff.io"><code>StreamRepository</code></a> with configurable lock timeouts.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>repository</code> - XML file storage</dd>
<dd><code>waitTimeout</code> - how long a thread will wait for a lock before throwing <a href="../../../../io/permazen/kv/RetryTransactionException.html" title="class in io.permazen.kv"><code>RetryTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dd><code>holdTimeout</code> - how long a thread may hold a contestested lock before throwing <a href="../../../../io/permazen/kv/RetryTransactionException.html" title="class in io.permazen.kv"><code>RetryTransactionException</code></a>
  in milliseconds, or zero for unlimited</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>waitTimeout</code> or <code>holdTimeout</code> is negative</dd>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>repository</code> is null</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getInitialContent--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getInitialContent</h4>
<pre>protected&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html?is-external=true" title="class or interface in java.io">InputStream</a>&nbsp;getInitialContent()
                                 throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Get the initial content for an uninitialized database. This method is invoked when, on the first load,
 the backing XML file is not found. It should return a stream that reads initial content for the database,
 if any, otherwise null.

 <p>
 The implementation in <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html" title="class in io.permazen.kv.simple"><code>XMLKVDatabase</code></a> opens and returns the <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io"><code>File</code></a> configured by
 <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#setInitialContentFile-java.io.File-"><code>setInitialContentFile()</code></a>, if any, otherwise null.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>default initial XML database content, or null for none</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if an error occurs accessing the initial content file</dd>
</dl>
</li>
</ul>
<a name="setInitialContentFile-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setInitialContentFile</h4>
<pre>public&nbsp;void&nbsp;setInitialContentFile(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;initialContentFile)</pre>
<div class="block">Configure the <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io"><code>File</code></a> containing default initial content for an uninitialized database. This method is invoked
 by <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#getInitialContent--"><code>getInitialContent()</code></a> when, on the first load, the backing XML file is not found.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>initialContentFile</code> - file containing default initial XML database content, or null for none</dd>
</dl>
</li>
</ul>
<a name="start--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>start</h4>
<pre>public&nbsp;void&nbsp;start()</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="../../../../io/permazen/kv/KVDatabase.html#start--">KVDatabase</a></code></span></div>
<div class="block">Start this instance. This method must be called prior to creating any transactions.

 <p>
 This method is idempotent: if this instance is already started, nothing happens.

 <p>
 Whether an instance that has been started and stopped can be restarted is implementation-dependent.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/KVDatabase.html#start--">start</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../io/permazen/kv/KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a></code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#start--">start</a></code>&nbsp;in class&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
</dl>
</li>
</ul>
<a name="createTransaction--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createTransaction</h4>
<pre>public&nbsp;<a href="../../../../io/permazen/kv/simple/XMLKVTransaction.html" title="class in io.permazen.kv.simple">XMLKVTransaction</a>&nbsp;createTransaction()</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="../../../../io/permazen/kv/KVDatabase.html#createTransaction--">KVDatabase</a></code></span></div>
<div class="block">Create a new transaction.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/KVDatabase.html#createTransaction--">createTransaction</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../io/permazen/kv/KVDatabase.html" title="interface in io.permazen.kv">KVDatabase</a></code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#createTransaction--">createTransaction</a></code>&nbsp;in class&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>newly created transaction</dd>
</dl>
</li>
</ul>
<a name="reload--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reload</h4>
<pre>public&nbsp;void&nbsp;reload()</pre>
<div class="block">Forcibly reload this database by re-reading the XML file.

 <p>
 Any transactions that are in-progress when this method is called immediately become unusable.</div>
</li>
</ul>
<a name="getGeneration--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getGeneration</h4>
<pre>public&nbsp;int&nbsp;getGeneration()</pre>
<div class="block">Get the generation number associated with the XML file.
 The generation number is incremented every time the database is wholesale updated by reading the file into memory,
 e.g., by invoking <a href="../../../../io/permazen/kv/simple/XMLKVDatabase.html#reload--"><code>reload()</code></a>.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>XML file generation number</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../io/permazen/kv/simple/XMLKVTransaction.html#getGeneration--"><code>XMLKVTransaction.getGeneration()</code></a></dd>
</dl>
</li>
</ul>
<a name="checkForOutOfBandUpdate--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkForOutOfBandUpdate</h4>
<pre>public&nbsp;boolean&nbsp;checkForOutOfBandUpdate()</pre>
<div class="block">Check the XML file's timestamp and reload it if it has been modified since the most recent
 read or write by this instance.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if file was updated and re-read, otherwise false</dd>
</dl>
</li>
</ul>
<a name="checkState-io.permazen.kv.simple.SimpleKVTransaction-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkState</h4>
<pre>protected&nbsp;void&nbsp;checkState(<a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx)</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from class:&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#checkState-io.permazen.kv.simple.SimpleKVTransaction-">SimpleKVDatabase</a></code></span></div>
<div class="block">Verify that the given transaction is still usable.

 <p>
 This method is invoked at the start of the <a href="../../../../io/permazen/kv/KVStore.html" title="interface in io.permazen.kv"><code>KVStore</code></a> data access and <a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html#commit--"><code>commit()</code></a>
 methods of the <a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple"><code>SimpleKVTransaction</code></a> associated with this instance. This allows for any checks which depend on
 a consistent view of the transaction and database together. This instance's lock will be held when this method is invoked.
 Note: transaction state is also protected by this instance's lock.

 <p>
 The implementation in <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> does nothing.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#checkState-io.permazen.kv.simple.SimpleKVTransaction-">checkState</a></code>&nbsp;in class&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>tx</code> - the transaction being accessed</dd>
</dl>
</li>
</ul>
<a name="postCommit-io.permazen.kv.simple.SimpleKVTransaction-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>postCommit</h4>
<pre>protected&nbsp;void&nbsp;postCommit(<a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple">SimpleKVTransaction</a>&nbsp;tx,
                          boolean&nbsp;successful)</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from class:&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#postCommit-io.permazen.kv.simple.SimpleKVTransaction-boolean-">SimpleKVDatabase</a></code></span></div>
<div class="block">Invoked during transaction commit just after writing changes to the underlying <a href="../../../../io/permazen/kv/KVStore.html" title="interface in io.permazen.kv"><code>KVStore</code></a>.

 <p>
 <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> guarantees this method and <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#preCommit-io.permazen.kv.simple.SimpleKVTransaction-"><code>preCommit()</code></a> will be invoked in matching pairs,
 and that this instance will be locked when these methods are invoked.

 <p>
 This method is invoked even if the underlying <a href="../../../../io/permazen/kv/KVStore.html" title="interface in io.permazen.kv"><code>KVStore</code></a> throws an exception while changes were being written to it.
 In that case, <code>successful</code> will be false.

 <p>
 The implementation in <a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple"><code>SimpleKVDatabase</code></a> does nothing.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html#postCommit-io.permazen.kv.simple.SimpleKVTransaction-boolean-">postCommit</a></code>&nbsp;in class&nbsp;<code><a href="../../../../io/permazen/kv/simple/SimpleKVDatabase.html" title="class in io.permazen.kv.simple">SimpleKVDatabase</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>tx</code> - the transaction that was committed</dd>
<dd><code>successful</code> - true if all changes were written back successfully,
  false if the underlying <a href="../../../../io/permazen/kv/KVStore.html" title="interface in io.permazen.kv"><code>KVStore</code></a> threw an exception during commit update</dd>
</dl>
</li>
</ul>
<a name="readXML--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readXML</h4>
<pre>protected&nbsp;void&nbsp;readXML()</pre>
</li>
</ul>
<a name="writeXML--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>writeXML</h4>
<pre>protected&nbsp;void&nbsp;writeXML()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/XMLKVDatabase.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/permazen/kv/simple/SimpleKVTransaction.html" title="class in io.permazen.kv.simple"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/permazen/kv/simple/XMLKVImplementation.html" title="class in io.permazen.kv.simple"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/permazen/kv/simple/XMLKVDatabase.html" target="_top">Frames</a></li>
<li><a href="XMLKVDatabase.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.io.permazen.kv.simple.SimpleKVDatabase">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2022. All rights reserved.</small></p>
</body>
</html>
