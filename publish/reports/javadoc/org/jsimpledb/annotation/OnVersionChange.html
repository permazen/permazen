<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<title>OnVersionChange (Java Class Library API)</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="OnVersionChange (Java Class Library API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OnVersionChange.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jsimpledb/annotation/OnDelete.html" title="annotation in org.jsimpledb.annotation"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jsimpledb/annotation/Validate.html" title="annotation in org.jsimpledb.annotation"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jsimpledb/annotation/OnVersionChange.html" target="_top">Frames</a></li>
<li><a href="OnVersionChange.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation_type_optional_element_summary">Optional</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#annotation_type_element_detail">Element</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.jsimpledb.annotation</div>
<h2 title="Annotation Type OnVersionChange" class="title">Annotation Type OnVersionChange</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Retention.html?is-external=true" title="class or interface in java.lang.annotation">@Retention</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Retention.html?is-external=true#value()" title="class or interface in java.lang.annotation">value</a>=<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html?is-external=true#RUNTIME" title="class or interface in java.lang.annotation">RUNTIME</a>)
<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Target.html?is-external=true" title="class or interface in java.lang.annotation">@Target</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Target.html?is-external=true#value()" title="class or interface in java.lang.annotation">value</a>=<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/ElementType.html?is-external=true#METHOD" title="class or interface in java.lang.annotation">METHOD</a>)
<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Documented.html?is-external=true" title="class or interface in java.lang.annotation">@Documented</a>
public @interface <a href="../../../src-html/org/jsimpledb/annotation/OnVersionChange.html#line.68">OnVersionChange</a></pre>
<div class="block">Annotation for methods that are to be invoked whenever an object's schema version has just changed.

 <p><b>Method Parameters</b></p>

 <p>
 The annotated method must be an instance method (i.e., not static), return void, and
 take one, two, or all three of the following parameters in order:
 <ol>
 <li><code>int oldVersion</code> - previous schema version; should be present only if <a href="../../../org/jsimpledb/annotation/OnVersionChange.html#oldVersion()"><code>oldVersion()</code></a> is zero</li>
 <li><code>int newVersion</code> - new schema version; should be present only if <a href="../../../org/jsimpledb/annotation/OnVersionChange.html#newVersion()"><code>newVersion()</code></a> is zero</li>
 <li><code>Map&lt;Integer, Object&gt; oldValues</code> <i>or</i> <code>Map&lt;String, Object&gt; oldValues</code> - immutable map containing
      all field values from the previous version of the object, indexed by either storage ID or field name.</li>
 </ol>

 <p>
 If a class has multiple <a href="../../../org/jsimpledb/annotation/OnVersionChange.html" title="annotation in org.jsimpledb.annotation"><code>&#64;OnVersionChange</code></a>-annotated methods, methods with more specific
 constraint(s) (i.e., non-zero <a href="../../../org/jsimpledb/annotation/OnVersionChange.html#oldVersion()"><code>oldVersion()</code></a> and/or <a href="../../../org/jsimpledb/annotation/OnVersionChange.html#newVersion()"><code>newVersion()</code></a>) will be invoked first.
 </p>

 <p><b>Incompatible Schema Changes</b></p>

 <p>
 JSimpleDB supports arbitrary Java model schema changes across schema versions, including adding and removing Java types.
 As a result, it's possible for the previous version of an object to contain reference fields whose Java types no longer exist
 in the current Java model. Specifically, this can happen in two ways:
 <ul>
 <li>A reference field refers to an object type that no longer exists; or</li>
 <li>An <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html?is-external=true" title="class or interface in java.lang"><code>Enum</code></a> field refers to an <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html?is-external=true" title="class or interface in java.lang"><code>Enum</code></a> type that no longer exists, or whose constants have changed</li>
 </ul>

 <p>
 In these cases, the old field's value cannot be represented in <code>oldValues</code> using the original Java types.
 Instead, more generic types are used:
 <ul>
 <li>For a reference field whose type no longer exists, the referenced object will be an <a href="../../../org/jsimpledb/UntypedJObject.html" title="class in org.jsimpledb"><code>UntypedJObject</code></a>.
      Note that the fields in the <a href="../../../org/jsimpledb/UntypedJObject.html" title="class in org.jsimpledb"><code>UntypedJObject</code></a> may still be accessed by invoking the
      <a href="../../../org/jsimpledb/JTransaction.html" title="class in org.jsimpledb"><code>JTransaction</code></a> field access methods with <code>upgradeVersion</code> set to false (otherwise,
      a <a href="../../../org/jsimpledb/core/TypeNotInSchemaVersionException.html" title="class in org.jsimpledb.core"><code>TypeNotInSchemaVersionException</code></a> is thrown).
 <li>For <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html?is-external=true" title="class or interface in java.lang"><code>Enum</code></a> fields whose type no longer exists or has modified constants, the old value
      will be represented as an <a href="../../../org/jsimpledb/core/EnumValue.html" title="class in org.jsimpledb.core"><code>EnumValue</code></a> object.</li>
 </ul>

 <p>
 In addition to Java types disappearing, it's also possible that the type of a reference field is narrower in the current
 Java code than it was in the previous Java code. If an object held a reference in such a field to another object outside
 the new, narrower type, then upgrading the object without change would represent a violation of Java type safety.
 Therefore, when any object is upgraded, all references that would otherwise be illegal are cleared (in the manner of
 <a href="../../../org/jsimpledb/core/DeleteAction.html#UNREFERENCE"><code>DeleteAction.UNREFERENCE</code></a>); use <code>oldValues</code> to access the previous field value(s) if needed.
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== ANNOTATION TYPE OPTIONAL MEMBER SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="annotation_type_optional_element_summary">
<!--   -->
</a>
<h3>Optional Element Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Optional Element Summary table, listing optional elements, and an explanation">
<caption><span>Optional Elements</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Optional Element and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/annotation/OnVersionChange.html#newVersion()">newVersion</a></strong></code>
<div class="block">Required new schema version.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/annotation/OnVersionChange.html#oldVersion()">oldVersion</a></strong></code>
<div class="block">Required old schema version.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ ANNOTATION TYPE MEMBER DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="annotation_type_element_detail">
<!--   -->
</a>
<h3>Element Detail</h3>
<a name="oldVersion()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>oldVersion</h4>
<pre>public abstract&nbsp;int&nbsp;<a href="../../../src-html/org/jsimpledb/annotation/OnVersionChange.html#line.86">oldVersion</a></pre>
<div class="block">Required old schema version.

 <p>
 If this property is set to a positive value, only version changes
 for which the previous schema version equals the specified version will result in notification,
 and the annotated method must have the corresponding parameter omitted. Otherwise notifications
 are delivered for any previous schema version and the <code>oldVersion</code> method parameter is required.
 </p>

 <p>
 Negative values are not allowed.
 </p></div>
<dl><dt><span class="strong">Returns:</span></dt><dd>old schema version, or zero for no restriction</dd></dl>
<dl>
<dt>Default:</dt>
<dd>0</dd>
</dl>
</li>
</ul>
<a name="newVersion()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>newVersion</h4>
<pre>public abstract&nbsp;int&nbsp;<a href="../../../src-html/org/jsimpledb/annotation/OnVersionChange.html#line.104">newVersion</a></pre>
<div class="block">Required new schema version.

 <p>
 If this property is set to a positive value, only version changes
 for which the new schema version equals the specified version will result in notification,
 and the annotated method must have the corresponding parameter omitted. Otherwise notifications
 are delivered for any new schema version and the <code>newVersion</code> method parameter is required.
 </p>

 <p>
 Negative values are not allowed.
 </p></div>
<dl><dt><span class="strong">Returns:</span></dt><dd>new schema version, or zero for no restriction</dd></dl>
<dl>
<dt>Default:</dt>
<dd>0</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OnVersionChange.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jsimpledb/annotation/OnDelete.html" title="annotation in org.jsimpledb.annotation"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jsimpledb/annotation/Validate.html" title="annotation in org.jsimpledb.annotation"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jsimpledb/annotation/OnVersionChange.html" target="_top">Frames</a></li>
<li><a href="OnVersionChange.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation_type_optional_element_summary">Optional</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#annotation_type_element_detail">Element</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
